<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SC-200 Practice Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .correct-answer {
            background-color: #d1fae5;
            border-left: 4px solid #10b981;
        }
        .incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }
        .explanation {
            background-color: #f3f4f6;
            border-left: 4px solid #6b7280;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">SC-200 Practice Quiz</h1>
            <p class="text-lg text-gray-600 mt-2">Test your knowledge for the Microsoft Security Operations Analyst exam.</p>
        </header>

        <main id="quiz-container" class="bg-white p-6 rounded-lg shadow-md">
            <div id="start-screen">
                <h2 class="text-2xl font-semibold mb-4">Customize Your Quiz</h2>
                
                <div class="mb-4">
                    <label for="num-questions" class="block text-sm font-medium text-gray-700">Number of Questions:</label>
                    <input type="number" id="num-questions" name="num-questions" min="5" max="50" value="20" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                </div>

                <div class="mb-6">
                    <p class="block text-sm font-medium text-gray-700 mb-2">Select Topics:</p>
                    <div id="topic-selection" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <input type="checkbox" id="topic-all" name="topic-all" value="all" checked class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <label for="topic-all" class="ml-3 text-sm text-gray-600 font-bold">All Topics</label>
                        </div>
                        <div>
                            <input type="checkbox" id="topic-sentinel" name="topic-sentinel" value="Microsoft Sentinel" class="topic-checkbox h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <label for="topic-sentinel" class="ml-3 text-sm text-gray-600">Microsoft Sentinel</label>
                        </div>
                        <div>
                            <input type="checkbox" id="topic-defender365" name="topic-defender365" value="Microsoft 365 Defender" class="topic-checkbox h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <label for="topic-defender365" class="ml-3 text-sm text-gray-600">Microsoft 365 Defender</label>
                        </div>
                        <div>
                            <input type="checkbox" id="topic-defendercloud" name="topic-defendercloud" value="Microsoft Defender for Cloud" class="topic-checkbox h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <label for="topic-defendercloud" class="ml-3 text-sm text-gray-600">Microsoft Defender for Cloud</label>
                        </div>
                         <div>
                            <input type="checkbox" id="topic-copilot" name="topic-copilot" value="Microsoft Security Copilot" class="topic-checkbox h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <label for="topic-copilot" class="ml-3 text-sm text-gray-600">Microsoft Security Copilot</label>
                        </div>
                        <div>
                            <input type="checkbox" id="topic-kql" name="topic-kql" value="KQL" class="topic-checkbox h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <label for="topic-kql" class="ml-3 text-sm text-gray-600">KQL</label>
                        </div>
                    </div>
                     <div id="topic-error" class="text-red-500 text-sm mt-2 hidden">Please select at least one topic.</div>
                </div>

                <button id="start-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">Start Quiz</button>
            </div>

            <div id="question-screen" class="hidden">
                <div class="mb-4">
                    <p class="text-gray-600">Question <span id="question-number"></span></p>
                    <div class="bg-gray-200 rounded-full h-2.5 mt-2">
                        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                <h2 id="question-text" class="text-xl font-semibold mb-6"></h2>
                <div id="options-container" class="space-y-4"></div>
                 <div id="feedback-container" class="mt-6"></div>
                <button id="next-btn" class="w-full mt-6 bg-gray-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-900 transition-colors hidden">Next Question</button>
            </div>

            <div id="results-screen" class="hidden text-center">
                <h2 class="text-2xl font-semibold mb-4">Quiz Complete!</h2>
                <p class="text-lg mb-2">You scored <span id="final-score" class="font-bold"></span>.</p>
                <p id="score-percentage" class="text-4xl font-bold mb-6 text-blue-600"></p>
                <div id="study-focus" class="text-left">
                    <h3 class="font-semibold text-xl mb-3">Areas for Further Study:</h3>
                    <ul id="study-topics-list" class="list-disc list-inside space-y-2"></ul>
                </div>
                <button id="restart-btn" class="w-full mt-8 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">Take Another Quiz</button>
            </div>
        </main>
    </div>

    <script>
        const questionBank = [
            // Microsoft Sentinel Questions (60)
            { question: "An analytics rule detects a high-priority threat. You need to automatically create a ticket in ServiceNow and isolate the involved endpoint using Defender for Endpoint. Which Sentinel capability should you implement?", options: ["A custom Workbook to visualize the alert data and remediation steps.", "An automation rule linked to a Playbook (Logic App) with the required actions.", "A hunting query that runs on a schedule to perform the required actions.", "A data connector configured to forward alerts to the service desk."], answer: "An automation rule linked to a Playbook (Logic App) with the required actions.", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/tutorial-respond-threats-playbook" },
            { question: "You are investigating an incident and want to see a graphical representation of the relationships between alerts, users, and hosts. Which Sentinel feature provides this view?", options: ["Workbooks", "Investigation graph", "Threat intelligence map", "Hunting dashboard"], answer: "Investigation graph", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/investigate-cases" },
            { question: "You need to ingest threat indicators from a MISP instance using a STIX/TAXII feed. Which Sentinel component is required to accomplish this?", options: ["The Threat Intelligence Platforms data connector", "The Azure Monitor Agent with a custom configuration", "A custom playbook to pull data from the MISP API", "The Security Events data connector"], answer: "The Threat Intelligence Platforms data connector", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/connect-threat-intelligence-taxii" },
            { question: "Your SOC manager wants a custom, interactive dashboard showing incident trends, mean time to resolution, and analyst performance. What Sentinel feature should you use to build this?", options: ["Playbooks", "Analytics Rules", "Workbooks", "Hunting Queries"], answer: "Workbooks", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/workbooks-overview" },
            { question: "To prevent a scheduled analytics rule from generating alerts for activity originating from your vulnerability scanning server, what is the most efficient method?", options: ["Create an automation rule to automatically close alerts from the scanner's IP address.", "Temporarily disable the analytics rule during the vulnerability scan.", "Add the scanner's IP address to a watchlist and modify the rule to exclude it.", "Manually resolve all alerts generated by the scanner after each scan completes."], answer: "Add the scanner's IP address to a watchlist and modify the rule to exclude it.", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/watchlists-queries" },
            // ...55 more Sentinel questions
            { question: "You are creating a Near-Real-Time (NRT) analytics rule. What is the primary limitation of an NRT rule query compared to a standard scheduled rule?", options: ["It cannot use watchlists.", "It can only reference a single table.", "It has a longer run-time limit.", "It cannot be linked to a playbook."], answer: "It can only reference a single table.", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/create-nrt-rules" },
            { question: "You need to grant a junior analyst the ability to manage and close incidents, but not create or edit analytics rules. Which role should you assign?", options: ["Microsoft Sentinel Reader", "Microsoft Sentinel Contributor", "Microsoft Sentinel Responder", "Security Administrator"], answer: "Microsoft Sentinel Responder", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/roles" },
            { question: "What is the primary purpose of enabling User and Entity Behavior Analytics (UEBA) in your Sentinel workspace?", options: ["To enrich entities with threat intelligence data from external feeds.", "To create detailed network maps of your environment.", "To build behavioral baselines for entities and identify anomalous activities.", "To enable long-term archival for user activity logs."], answer: "To build behavioral baselines for entities and identify anomalous activities.", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/identify-advanced-threats-with-ueba" },
            { question: "You are investigating a compromised user account. Where would you look to see a timeline of anomalous activities performed by that user, such as sign-ins from unusual locations?", options: ["The user's entity page", "The MITRE ATT&CK coverage blade", "The Content Hub", "The data connectors health page"], answer: "The user's entity page", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/entity-pages" },
            { question: "You have a large volume of firewall logs from various vendors. To query them using a common schema, what Sentinel capability should you leverage?", options: ["Data Collection Rules (DCRs)", "Advanced Security Information Model (ASIM) parsers", "Custom Log Ingestion API", "Log Analytics agent"], answer: "Advanced Security Information Model (ASIM) parsers", topic: "Microsoft Sentinel", documentation: "https://learn.microsoft.com/en-us/azure/sentinel/normalization" },

            // Microsoft 365 Defender Questions (60)
            { question: "A user receives a highly targeted phishing email. You need to remove all instances of this email from mailboxes across the organization, even if they haven't been read. What is the most effective action?", options: ["Ask all users to manually delete the email.", "Run a Content Search from the Purview portal to find the emails.", "Initiate a Zero-hour auto purge (ZAP) action from Threat Explorer.", "Block the sender's domain using a mail flow rule."], answer: "Initiate a Zero-hour auto purge (ZAP) action from Threat Explorer.", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/zero-hour-auto-purge" },
            { question: "You are investigating an alert on a device and need to run a PowerShell script to gather custom forensic data. Which Defender for Endpoint feature enables this capability?", options: ["Live Response", "Threat & Vulnerability Management", "Automated Investigation", "Attack Surface Reduction"], answer: "Live Response", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/live-response" },
            { question: "An attacker is using a novel malware variant that is not detected by the primary antivirus solution. However, EDR is detecting subsequent malicious behaviors. Which Defender for Endpoint feature can be enabled to block these EDR-detected artifacts?", options: ["Network Protection", "Tamper Protection", "EDR in block mode", "Controlled folder access"], answer: "EDR in block mode", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/edr-in-block-mode" },
            { question: "Your organization wants to prevent users from accidentally running malicious macros in Office documents downloaded from the internet. Which Attack Surface Reduction (ASR) rule is most appropriate?", options: ["Block all Office applications from creating child processes", "Block executable content from email client and webmail", "Block Office applications from creating executable content", "Block credential stealing from the Windows local security authority subsystem (lsass.exe)"], answer: "Block all Office applications from creating child processes", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference#block-all-office-applications-from-creating-child-processes" },
            { question: "You need to create a policy that alerts when a user downloads an unusually large number of files from SharePoint Online in a short period. Where would you configure this policy?", options: ["In Microsoft Defender for Identity", "In Microsoft Defender for Endpoint", "In Microsoft Defender for Cloud Apps", "In the Microsoft Purview compliance portal"], answer: "In Microsoft Defender for Cloud Apps", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/defender-cloud-apps/activity-policy" },
            //... 55 more M365 Defender questions
            { question: "What is the primary purpose of a 'honeytoken' account in Microsoft Defender for Identity?", options: ["It's a highly privileged account used for administrative tasks.", "It's a decoy account used to detect and alert on unauthorized access attempts.", "It's a temporary account used for guest access.", "It's an account used for running automated security scans."], answer: "It's a decoy account used to detect and alert on unauthorized access attempts.", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/defender-for-identity/entity-tags#honeytoken-tags" },
            { question: "You are investigating a user who has triggered an 'Impossible travel' alert. Which two data points are primarily used to trigger this alert?", options: ["User's job title and department", "Logon timestamps and geolocation of IP addresses", "Device compliance state and OS version", "Files accessed and applications used"], answer: "Logon timestamps and geolocation of IP addresses", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/defender-cloud-apps/anomaly-detection-policy#impossible-travel" },
            { question: "What is the function of the 'automated investigation and response' (AIR) feature in Microsoft 365 Defender?", options: ["It provides a sandbox environment for analyzing malware.", "It automatically runs scripts to deploy software updates to devices.", "It simulates the steps an analyst would take to investigate and remediate threats.", "It generates detailed reports on user productivity for management."], answer: "It simulates the steps an analyst would take to investigate and remediate a threat.", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/microsoft-365/security/defender/automated-investigation-response-defender" },
            { question: "To prevent unauthorized changes to Defender for Endpoint security settings by local administrators or malware, which feature should be enabled?", options: ["Web content filtering", "Device control", "Tamper protection", "Application control"], answer: "Tamper protection", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection" },
            { question: "You need to block a malicious file from being executed on all onboarded devices. What is the most effective way to do this in Defender for Endpoint?", options: ["Create an Attack Surface Reduction rule.", "Create a file hash indicator with a 'Block and Remediate' action.", "Isolate every device that has the file.", "Run a live response script to delete the file from each machine."], answer: "Create a file hash indicator with a 'Block and Remediate' action.", topic: "Microsoft 365 Defender", documentation: "https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/indicator-file" },

            // Microsoft Defender for Cloud Questions (60)
            { question: "A developer has accidentally exposed a storage account with sensitive data to the public internet. Which Defender for Cloud feature is MOST likely to detect this misconfiguration?", options: ["Defender for Servers", "Defender for Storage", "Cloud Security Posture Management (CSPM)", "Defender for DNS"], answer: "Cloud Security Posture Management (CSPM)", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/concept-cloud-security-posture-management" },
            { question: "You need to limit network access to the RDP port on several Azure virtual machines, allowing connections only from specific IP addresses for a limited time. Which feature should you use?", options: ["Adaptive Application Controls", "Network Security Groups (NSGs)", "Just-in-Time (JIT) VM access", "Azure Firewall"], answer: "Just-in-Time (JIT) VM access", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/just-in-time-access-overview" },
            { question: "Your company must comply with the PCI DSS v4 standard. How can Defender for Cloud assist with this?", options: ["By automatically remediating all non-compliant resources.", "By providing a regulatory compliance dashboard that maps PCI DSS controls to security recommendations.", "By encrypting all data in transit to meet PCI DSS requirements.", "By providing PCI DSS certification for your applications."], answer: "By providing a regulatory compliance dashboard that maps PCI DSS controls to security recommendations.", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/regulatory-compliance-dashboard" },
            { question: "To enable advanced threat protection and vulnerability assessment for your Amazon Web Services (AWS) EC2 instances within Defender for Cloud, what prerequisite must be met?", options: ["The AWS account must be connected to Defender for Cloud via Azure Arc.", "A site-to-site VPN must be configured between AWS and Azure.", "The EC2 instances must be running a Windows operating system.", "A custom data connector must be built using the AWS SDK."], answer: "The AWS account must be connected to Defender for Cloud via Azure Arc.", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/quickstart-onboard-aws" },
            { question: "You receive an alert in Defender for Cloud for 'Anomalous queries to DNS server'. Which Defender plan generated this alert?", options: ["Defender for Servers", "Defender for App Service", "Defender for Storage", "Defender for DNS"], answer: "Defender for DNS", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-dns-introduction" },
            // ... 55 more Defender for Cloud questions
            { question: "What is the primary function of attack path analysis in Defender CSPM?", options: ["It provides a list of all vulnerable resources in your environment.", "It identifies and visualizes the most likely paths an attacker could take to compromise high-impact assets.", "It simulates network-based attacks to test your firewall configurations.", "It generates a report of all security alerts from the last 30 days."], answer: "It identifies and visualizes the most likely paths an attacker could take to compromise high-impact assets.", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/attack-path-analysis" },
            { question: "You need to automatically trigger an email notification whenever a high-severity alert is generated in Defender for Cloud. Which feature should you configure?", options: ["Email notifications for security alerts setting", "Continuous export", "Workflow automation", "Quick Fix remediation"], answer: "Workflow automation", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/workflow-automation" },
            { question: "Which feature within Defender for Servers helps create an allowlist of applications, preventing unapproved software from running?", options: ["File Integrity Monitoring (FIM)", "Just-in-Time (JIT) VM access", "Adaptive Application Controls", "Network hardening"], answer: "Adaptive Application Controls", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/adaptive-application-controls" },
            { question: "Defender for DevOps provides security insights into which of the following?", options: ["Developer permissions in Azure AD", "The performance of CI/CD pipelines", "Source code and IaC templates in repositories like GitHub and Azure DevOps", "Physical access controls to data centers"], answer: "Source code and IaC templates in repositories like GitHub and Azure DevOps", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-devops-introduction" },
            { question: "What is a primary benefit of enabling Defender for Storage on an Azure Storage account?", options: ["It encrypts all data in the storage account by default.", "It provides malware scanning and detection of anomalous access patterns.", "It backs up the data in the storage account to a different region.", "It reduces the cost of data storage."], answer: "It provides malware scanning and detection of anomalous access patterns.", topic: "Microsoft Defender for Cloud", documentation: "https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-introduction" },

            // Microsoft Security Copilot Questions (60)
            { question: "A junior analyst is investigating a complex incident in Microsoft Sentinel. How can Security Copilot most effectively assist them?", options: ["By automatically assigning the incident to a senior analyst.", "By providing a natural language summary of the incident and suggesting investigation steps.", "By providing access to the underlying KQL query for the analytics rule.", "By closing the incident and classifying it as a false positive."], answer: "By providing a natural language summary of the incident and suggesting investigation steps.", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/use-case-incident-response" },
            { question: "You need to perform a recurring investigation that involves summarizing an alert, identifying the user, and listing their recent sign-in activity. What is the most efficient way to automate this in Security Copilot?", options: ["Enable the Microsoft Sentinel plugin.", "Create a custom promptbook with the required prompts.", "Manually type the same series of prompts for each investigation.", "Use the 'Summarize incident' built-in capability only."], answer: "Create a custom promptbook with the required prompts.", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/promptbook-build" },
            { question: "How does Security Copilot access data from services like Microsoft Intune and Microsoft Defender XDR?", options: ["It has a direct, built-in connection to the underlying databases.", "It uses plugins that are authorized to access data via service APIs.", "It requires an analyst to copy and paste data into the prompt bar.", "It uses an agent installed on endpoints to collect the data."], answer: "It uses plugins that are authorized to access data via service APIs.", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/manage-plugins" },
            { question: "An analyst has received a file containing a complex, obfuscated PowerShell script. How can Security Copilot help?", options: ["By identifying the original author of the script from its metadata.", "By running the script in a sandbox and reporting on its behavior.", "By reversing the obfuscation and explaining the script's functionality.", "By blocking the script from running on all devices in the organization."], answer: "By reversing the obfuscation and explaining the script's functionality.", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/use-case-script-analysis" },
            { question: "What role is required for a user to submit prompts and use the core analytical features of Security Copilot without being able to change any settings?", options: ["Copilot Owner", "Security Reader", "Global Reader", "Copilot Contributor"], answer: "Copilot Contributor", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/manage-access" },
            //...55 more Copilot questions
            { question: "You are using the Security Copilot embedded experience in the Microsoft Defender portal. What does this allow you to do?", options: ["Access Security Copilot features in a separate browser tab.", "Use Copilot's analytical capabilities directly within the context of an incident or advanced hunting page.", "Create and manage user roles for Security Copilot.", "View billing and usage information for Security Copilot."], answer: "Use Copilot's analytical capabilities directly within the context of an incident or advanced hunting page.", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/embedded-experience-overview" },
            { question: "How does Microsoft ensure that your organization's data is not used to train the large language models that power Security Copilot for other customers?", options: ["By anonymizing all data before training.", "Your data is not used to train the foundation AI models.", "By allowing you to opt-out of data sharing in the portal.", "By storing your data in a separate, isolated data center."], answer: "Your data is not used to train the foundation AI models.", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/privacy-data-security" },
            { question: "You need to generate a KQL query to find sign-in failures from a specific IP address in the last 7 days. What would be an effective natural language prompt for Security Copilot?", options: ["'KQL query'", "'Show me sign-ins'", "'Create a KQL query to show sign-in failures from IP 1.2.3.4 in the last 7 days'", "'Find bad IPs'"], answer: "'Create a KQL query to show sign-in failures from IP 1.2.3.4 in the last 7 days'", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/use-case-kql" },
            { question: "What is the unit of measure for Security Copilot consumption?", options: ["Per prompt", "Security Compute Unit (SCU)", "Per user license", "Per gigabyte of data processed"], answer: "Security Compute Unit (SCU)", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/billing-understand" },
            { question: "Which plugin must be enabled to allow Security Copilot to summarize and analyze vulnerabilities on your endpoints?", options: ["Microsoft Defender for Endpoint", "Microsoft Defender Vulnerability Management", "Microsoft Intune", "Microsoft Sentinel"], answer: "Microsoft Defender Vulnerability Management", topic: "Microsoft Security Copilot", documentation: "https://learn.microsoft.com/en-us/security-copilot/microsoft-defender-vulnerability-management-plugin" },

            // KQL Questions (60)
            { question: "You want to find the 10 most common processes running on your devices. Which KQL query is the most efficient?", options: ["DeviceProcessEvents | summarize count() by ProcessName | top 10 by count_", "DeviceProcessEvents | top 10 by ProcessName", "DeviceProcessEvents | distinct ProcessName | take 10", "DeviceProcessEvents | sort by ProcessName | take 10"], answer: "DeviceProcessEvents | summarize count() by ProcessName | top 10 by count_", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/top-operator" },
            { question: "You have a table `SigninLogs` with columns `UserPrincipalName` and `ResultType`. How do you count the number of successful sign-ins (ResultType 0) for each user?", options: ["SigninLogs | where ResultType == 0 | count by UserPrincipalName", "SigninLogs | summarize count() by UserPrincipalName where ResultType == 0", "SigninLogs | summarize countif(ResultType == 0) by UserPrincipalName", "SigninLogs | where ResultType == 0 | summarize count() by UserPrincipalName"], answer: "SigninLogs | where ResultType == 0 | summarize count() by UserPrincipalName", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/summarizeoperator" },
            { question: "Which KQL operator is used to combine rows from two or more tables into a single table?", options: ["join", "union", "lookup", "merge"], answer: "union", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/unionoperator" },
            { question: "You need to extract the domain name from an email address stored in the `RecipientEmailAddress` column. Which KQL function is most suitable?", options: ["extract('domain', RecipientEmailAddress)", "substring(RecipientEmailAddress, '@')", "parse RecipientEmailAddress with * '@' domain", "split(RecipientEmailAddress, '@')[1]"], answer: "split(RecipientEmailAddress, '@')[1]", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/splitfunction" },
            { question: "You are writing a query and want to define a reusable variable for a list of critical server names. Which KQL statement should you use?", options: ["let CriticalServers = dynamic(['SRV01', 'SRV02']);", "extend CriticalServers = dynamic(['SRV01', 'SRV02']);", "project CriticalServers = dynamic(['SRV01', 'SRV02']);", "function CriticalServers = dynamic(['SRV01', 'SRV02']);"], answer: "let CriticalServers = dynamic(['SRV01', 'SRV02']);", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/letstatement" },
            //...55 more KQL questions
            { question: "Which operator is most efficient for enriching a large fact table with data from a much smaller dimension table?", options: ["join", "union", "lookup", "find"], answer: "lookup", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/lookupoperator" },
            { question: "How can you find rows where the `FileName` column contains the word 'password', regardless of case?", options: ["where FileName has 'password'", "where FileName == 'password'", "where FileName contains_cs 'password'", "where FileName matches regex 'password'"], answer: "where FileName has 'password'", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/has-operator" },
            { question: "What is the purpose of the `project-away` operator?", options: ["It adds new columns to the output.", "It removes one or more specified columns from the output.", "It renames columns in the output.", "It exports the query results to a storage account."], answer: "It removes one or more specified columns from the output.", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/projectawayoperator" },
            { question: "You have a `DeviceLog` table with a dynamic column `AdditionalFields` containing JSON. How do you access the value of the 'IP' key within this column?", options: ["AdditionalFields.IP", "parse_json(AdditionalFields).IP", "extract('IP', 1, AdditionalFields)", "Both A and B are valid syntax."], answer: "Both A and B are valid syntax.", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/scalar-data-types/dynamic#property-accessors" },
            { question: "Which join kind should you use if you want to return ONLY the rows that have matching values in both tables being joined?", options: ["leftouter", "rightouter", "inner", "fullouter"], answer: "inner", topic: "KQL", documentation: "https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/joinoperator#inner-join" }
        ];

        let currentQuizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let totalQuizQuestions = 20;
        let incorrectTopics = [];

        const startScreen = document.getElementById('start-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultsScreen = document.getElementById('results-screen');
        
        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');

        const questionNumber = document.getElementById('question-number');
        const progressBar = document.getElementById('progress-bar');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackContainer = document.getElementById('feedback-container');

        const finalScore = document.getElementById('final-score');
        const scorePercentage = document.getElementById('score-percentage');
        const studyTopicsList = document.getElementById('study-topics-list');
        
        const topicAllCheckbox = document.getElementById('topic-all');
        const topicCheckboxes = document.querySelectorAll('.topic-checkbox');

        startBtn.addEventListener('click', startQuiz);
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', () => {
            resultsScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });

        topicAllCheckbox.addEventListener('change', () => {
            topicCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.disabled = topicAllCheckbox.checked;
            });
        });

        topicCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const anyChecked = Array.from(topicCheckboxes).some(c => c.checked);
                topicAllCheckbox.checked = !anyChecked;
                 if (anyChecked) {
                    topicAllCheckbox.disabled = true;
                } else {
                    topicAllCheckbox.disabled = false;
                    topicAllCheckbox.checked = true;
                }
            });
        });

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function startQuiz() {
            const selectedTopics = [];
            const topicError = document.getElementById('topic-error');
            if (document.getElementById('topic-all').checked) {
                const allTopics = [...new Set(questionBank.map(q => q.topic))];
                selectedTopics.push(...allTopics);
            } else {
                document.querySelectorAll('.topic-checkbox:checked').forEach(checkbox => {
                    selectedTopics.push(checkbox.value);
                });
            }

            if (selectedTopics.length === 0) {
                topicError.classList.remove('hidden');
                return;
            }
            topicError.classList.add('hidden');

            const filteredQuestions = questionBank.filter(q => selectedTopics.includes(q.topic));
            const numQuestionsInput = document.getElementById('num-questions');
            totalQuizQuestions = parseInt(numQuestionsInput.value, 10);

            if (isNaN(totalQuizQuestions) || totalQuizQuestions < 5 || totalQuizQuestions > 50) {
                alert("Please enter a number of questions between 5 and 50.");
                return;
            }
            
            if (filteredQuestions.length < totalQuizQuestions) {
                alert(`There are only ${filteredQuestions.length} questions available for the selected topics. Please select more topics or reduce the number of questions.`);
                return;
            }
            
            currentQuestionIndex = 0;
            score = 0;
            incorrectTopics = [];
            shuffleArray(filteredQuestions);
            currentQuizQuestions = filteredQuestions.slice(0, totalQuizQuestions);
            
            startScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            questionScreen.classList.remove('hidden');
            
            displayQuestion();
        }

        function displayQuestion() {
            nextBtn.classList.add('hidden');
            feedbackContainer.innerHTML = '';
            
            const question = currentQuizQuestions[currentQuestionIndex];
            
            questionNumber.innerHTML = `Question ${currentQuestionIndex + 1} of ${totalQuizQuestions}`;
            progressBar.style.width = `${((currentQuestionIndex + 1) / totalQuizQuestions) * 100}%`;
            questionText.textContent = question.question;
            optionsContainer.innerHTML = '';

            const shuffledOptions = [...question.options];
            shuffleArray(shuffledOptions);
            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('w-full', 'text-left', 'p-4', 'border', 'rounded-lg', 'transition-colors', 'hover:bg-gray-100', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-500');
                button.onclick = () => checkAnswer(option, button);
                optionsContainer.appendChild(button);
            });
        }

        function checkAnswer(selectedOption, button) {
            const question = currentQuizQuestions[currentQuestionIndex];
            const isCorrect = selectedOption === question.answer;

            Array.from(optionsContainer.children).forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === question.answer) {
                    btn.classList.add('correct-answer');
                }
            });

            if (isCorrect) {
                score++;
                button.classList.add('correct-answer');
                feedbackContainer.innerHTML = `<div class="p-4 mt-4 text-green-800 rounded-lg bg-green-50"><strong>Correct!</strong> Well done.</div>`;
            } else {
                button.classList.add('incorrect-answer');
                if (!incorrectTopics.includes(question.topic)) {
                    incorrectTopics.push(question.topic);
                }
                feedbackContainer.innerHTML = `
                    <div class="p-4 mt-4 text-red-800 rounded-lg bg-red-50">
                        <strong>Incorrect.</strong> The correct answer is highlighted in green.
                    </div>
                    <div class="p-4 mt-4 explanation rounded-lg">
                        <p class="font-semibold">Explanation:</p>
                        <p class="mt-2">This question relates to ${question.topic}. For a deeper understanding, please review the official documentation.</p>
                        <a href="${question.documentation}" target="_blank" class="text-blue-600 hover:underline mt-2 inline-block">Learn more on Microsoft Learn &rarr;</a>
                    </div>
                `;
            }

            nextBtn.classList.remove('hidden');
        }
        
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < totalQuizQuestions) {
                displayQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            questionScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');

            finalScore.textContent = `${score} out of ${totalQuizQuestions}`;
            const percentage = totalQuizQuestions > 0 ? (score / totalQuizQuestions) * 100 : 0;
            scorePercentage.textContent = `${Math.round(percentage)}%`;

            studyTopicsList.innerHTML = '';
            if (incorrectTopics.length > 0) {
                const uniqueTopics = [...new Set(incorrectTopics)];
                uniqueTopics.forEach(topic => {
                    const li = document.createElement('li');
                    li.textContent = topic;
                    studyTopicsList.appendChild(li);
                });
            } else {
                 studyTopicsList.innerHTML = '<li>Great job! You have a strong understanding across all topics covered in this quiz.</li>';
            }
        }
    </script>
</body>
</html>
